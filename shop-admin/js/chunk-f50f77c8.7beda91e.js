(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f50f77c8"],{"18bb":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("el-card",[a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"primary"},on:{click:e.showAdd}},[e._v("添加角色")])],1),a("div",{staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.roles,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.children.length>0?a("div",e._l(t.row.children,(function(s,r){return a("div",{key:r,staticClass:"level"},[a("div",{staticClass:"levelone"},[a("el-tag",{attrs:{closable:""},on:{close:function(a){return e.removeRightById(t.row,s.id)}}},[e._v(e._s(s.authName))]),a("span",{staticClass:"right-icon"},[a("i",{staticClass:"el-icon-caret-right"})])],1),s.children.length>0?a("div",{staticClass:"leveltwo"},e._l(s.children,(function(s,r){return a("div",{key:r,staticClass:"two-tag"},[a("el-tag",{attrs:{type:"success",closable:""},on:{close:function(a){return e.removeRightById(t.row,s.id)}}},[e._v(e._s(s.authName))]),a("span",{staticClass:"right-icon"},[a("i",{staticClass:"el-icon-caret-right"})]),s.children&&s.children.length>0?a("div",{staticClass:"leveltwo levelthree"},e._l(s.children,(function(s,r){return a("div",{key:r,staticClass:"two-tag"},[a("el-tag",{staticStyle:{"margin-left":"20px"},attrs:{type:"warning",closable:""},on:{close:function(a){return e.removeRightById(t.row,s.id)}}},[e._v(e._s(s.authName))])],1)})),0):e._e()],1)})),0):e._e()])})),0):e._e(),0===t.row.children.length?a("div",[e._v("暂无权限")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"#",type:"index",align:"center"}}),a("el-table-column",{attrs:{label:"职位",prop:"roleName",align:"center"}}),a("el-table-column",{attrs:{label:"描述",prop:"roleDesc",align:"center"}}),a("el-table-column",{attrs:{label:"操作",width:"350",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.showUpdateDialog(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteRole(t.row)}}},[e._v("删除")]),a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(a){return e.setting(t.row)}}},[e._v("分配权限")])]}}])})],1)],1)]),a("el-dialog",{attrs:{title:"添加角色",visible:e.addDialog,"show-close":!1,width:"30%"},on:{"update:visible":function(t){e.addDialog=t}}},[a("div",[a("el-form",{ref:"addRuleForm",attrs:{model:e.addRuleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"角色名",prop:"name"}},[a("el-input",{model:{value:e.addRuleForm.name,callback:function(t){e.$set(e.addRuleForm,"name",t)},expression:"addRuleForm.name"}})],1),a("el-form-item",{attrs:{label:"角色描述",prop:"desc"}},[a("el-input",{model:{value:e.addRuleForm.desc,callback:function(t){e.$set(e.addRuleForm,"desc",t)},expression:"addRuleForm.desc"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.cancelAdd("addRuleForm")}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addRole("addRuleForm")}}},[e._v("确 定")])],1)]),a("el-dialog",{attrs:{title:"编辑角色",visible:e.updateDialog,"show-close":!1,width:"30%"},on:{"update:visible":function(t){e.updateDialog=t}}},[a("div",[a("el-form",{ref:"updateRuleForm",attrs:{model:e.updateRuleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"角色名",prop:"name"}},[a("el-input",{model:{value:e.updateRuleForm.name,callback:function(t){e.$set(e.updateRuleForm,"name",t)},expression:"updateRuleForm.name"}})],1),a("el-form-item",{attrs:{label:"角色描述",prop:"desc"}},[a("el-input",{model:{value:e.updateRuleForm.desc,callback:function(t){e.$set(e.updateRuleForm,"desc",t)},expression:"updateRuleForm.desc"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.cancelUpdate("updateRuleForm")}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateRole("updateRuleForm")}}},[e._v("确 定")])],1)]),a("el-dialog",{attrs:{title:"分配权限",visible:e.settingDialog,"show-close":!1,width:"50%"},on:{"update:visible":function(t){e.settingDialog=t},close:e.closeSettingDialog}},[a("el-tree",{ref:"treeRef",attrs:{data:e.rightslist,props:e.treeProps,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":e.defKeys}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.settingDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setRoles}},[e._v("确 定")])],1)],1)],1)},r=[],n=(a("b4fb"),a("fe59"),a("9302"),a("053b"),a("08ba"),a("6a61"),a("9666")),i=a("a7c7"),o={data:function(){return{roles:[],addDialog:!1,updateDialog:!1,addRuleForm:{name:"",desc:""},updateRuleForm:{name:"",desc:""},rules:{name:[{required:!0,message:"角色名不能为空",trigger:"blur"},{min:2,max:8,message:"长度在 2 到 8 个字符",trigger:"blur"}]},settingDialog:!1,rightslist:[],treeProps:{label:"authName",children:"children"},defKeys:[],roleId:"",updateId:""}},components:{},methods:{getData:function(){var e=this;this.$api.getRole().then((function(t){200===t.meta.status&&(e.roles=t.data)})).catch((function(e){console.log(e)}))},getRights:function(){var e=this;this.$api.allRights({type:"tree"}).then((function(t){200==t.meta.status&&(e.rightslist=t.data)}))},setting:function(e){this.roleId=e.id,this.getRights(),this.getLeafKeys(e,this.defKeys),this.settingDialog=!0},getLeafKeys:function(e,t){var a=this;if(!e.children)return t.push(e.id);e.children.forEach((function(e){return a.getLeafKeys(e,t)}))},closeSettingDialog:function(){this.defKeys=[]},setRoles:function(){var e=this,t=[].concat(Object(i["a"])(this.$refs.treeRef.getCheckedKeys()),Object(i["a"])(this.$refs.treeRef.getHalfCheckedKeys())),a=t.join(","),s=this.roleId;this.$api.serRoles({roleId:s,rids:a}).then((function(t){200===t.meta.status&&(e.$message.success(t.meta.msg),e.getData(),e.settingDialog=!1)})).catch((function(e){console.log(e)}))},removeRightById:function(e,t){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var r,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,a.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((function(e){return e}));case 2:if(r=s.sent,"confirm"===r){s.next=5;break}return s.abrupt("return",a.$message.info("取消了删除！"));case 5:return s.next=7,a.$api.deleteRights({roleId:e.id,rightId:t});case 7:if(n=s.sent,200===n.meta.status){s.next=12;break}return s.abrupt("return",a.$message.error("删除权限失败！"));case 12:a.$message.success("删除权限成功");case 13:e.children=n.data;case 14:case"end":return s.stop()}}),s)})))()},showAdd:function(){this.addDialog=!0},addRole:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return console.log("error submit!!"),!1;t.$api.addRole({roleName:t.addRuleForm.name,roleDesc:t.addRuleForm.desc}).then((function(a){201===a.meta.status?(t.$message.success("添加成功"),t.addDialog=!1,t.$refs[e].resetFields(),t.getData()):t.$message.error("添加失败")}))})),this.addDialog=!1},deleteRole:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((function(e){return e}));case 2:if(s=a.sent,"confirm"===s){a.next=5;break}return a.abrupt("return",t.$message.info("取消了删除！"));case 5:return a.next=7,t.$api.deleteRole({id:e.id});case 7:r=a.sent,200===r.meta.status?(t.$message.success(r.meta.msg),t.getData()):t.$message.error("删除失败");case 9:case"end":return a.stop()}}),a)})))()},cancelAdd:function(e){this.$refs[e].resetFields(),this.addDialog=!1},cancelUpdate:function(e){this.$refs[e].resetFields(),this.updateDialog=!1},showUpdateDialog:function(e){this.updateId=e.id,this.updateRuleForm.name=e.roleName,this.updateDialog=!0},updateRole:function(e){var t=this;this.$refs[e].validate((function(a){if(!a)return console.log("error submit!!"),!1;t.$api.updateRole({id:t.updateId,roleName:t.updateRuleForm.name,roleDesc:t.updateRuleForm.desc}).then((function(a){200===a.meta.status?(t.updateDialog=!1,t.$refs[e].resetFields(),t.getData(),t.$message.success("修改成功")):t.$message.error("修改失败")}))}))}},mounted:function(){this.getData()},watch:{},computed:{}},l=o,c=(a("75ec"),a("9ca4")),u=Object(c["a"])(l,s,r,!1,null,"9dd2cfa8",null);t["default"]=u.exports},"75ec":function(e,t,a){"use strict";var s=a("ac0d"),r=a.n(s);r.a},ac0d:function(e,t,a){}}]);